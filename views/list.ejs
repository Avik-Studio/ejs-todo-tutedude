<!DOCTYPE html>
<html lang="en">
<head>
    <title>My Todo List</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="main-box">
        <h1>Todo List</h1>

        <form action="/" method="GET" id="filterForm">
            <label for="priority">Filter:</label>
            <select name="priority" id="priority" onchange="document.getElementById('filterForm').submit()">
                <option value="all" <%= currentPriority === "all" ? "selected" : "" %>>All</option>
                <option value="high" <%= currentPriority === "high" ? "selected" : "" %>>High</option>
                <option value="medium" <%= currentPriority === "medium" ? "selected" : "" %>>Medium</option>
                <option value="low" <%= currentPriority === "low" ? "selected" : "" %>>Low</option>
            </select>
        </form>
    </div>

    <div class="task-section">
        <!-- Task Items -->
        <% if(items && items.length > 0) { %>
            <% for(let k=0; k<items.length; k++){ %>
                <% let index = indices[k]; %>
                <div class="task-row <%= items[k].priority %>">
                    <input type="checkbox" />
                    <div class="task-text">
                        <span><%= items[k].text %></span>
                        <small class="badge <%= items[k].priority %>"><%= items[k].priority %></small>
                    </div>
                    <div class="buttons">
                        <form action="/edit/<%= index %>" method="GET" class="inline">
                            <button>Edit</button>
                        </form>
                        <form action="/delete/<%= index %>" method="POST" class="inline">
                            <button>Delete</button>
                        </form>
                    </div>
                </div>
            <% } %>
        <% } else { %>
            <p>No tasks found. Add some!</p>
        <% } %>
    </div>

    <form action="/" method="POST" id="addTaskForm" onsubmit="return checkTask()">
        <input type="text" name="ele1" id="taskField" placeholder="Enter a task here..." />
        <select name="priority">
            <option value="high">High</option>
            <option value="medium" selected>Medium</option>
            <option value="low">Low</option>
        </select>
        <button type="submit">Add</button>
    </form>

    <div id="msg" style="display:none; color:red;">Task cannot be empty!</div>

    <script>
        function checkTask(){
            const input = document.getElementById("taskField");
            const message = document.getElementById("msg");
            if(!input.value.trim()){
                message.style.display = "block";
                setTimeout(()=> message.style.display="none", 2500);
                return false;
            }
            return true;
        }
    </script>
</body>
</html>
